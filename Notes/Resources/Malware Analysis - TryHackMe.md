A set of multiple modules that teaches Malware Analysis
##### Table of Contents 
- x86 Architecture Overview
- x86 Assembly Crash Course 
- Windows Internals 
- Dissecting PE Headers 
- Basic Static Analysis
- MalBuster 
- Advanced Static Analysis 
- Basic Dynamic Analysis
- Dynamic Analysis: Debugging
- Anti-Reverse Engineering
- MalDoc: Static Analysis
## x86 Architecture Overview
The way malware does its damage is by taking advantage of how the architecture is designed. Because of this, we need to understand how our systems are built, in order to properly analysis the way malware disrupts it. 
###### Table of Contents
- What is a CPU and its components 
- CPU registers and their uses 
- Memory layout viewed by a program 
- Stack layout and stack registers 
### CPU Architecture Overview
![[8ddadb4fef3506e96698c52fdb668f62.png]]
#### Control Unit 
- Takes instructions from the Main Memory (RAM) ~~one line at a time~~
	- **Gets instructions from the main memory**
- Uses the register called Instruction Pointer (IP) to get the address of ~~each instruction~~ **the next instruction**
	- 32-bit **systems** are called EIP (Extended) and 64-bit **systems** are called RIP (Register)
#### Arithmetic Logic Unit 
- Takes ~~one instruction at a time~~ **instructions** from the Main Memory (RAM) and executes it.
- Output is stored either in the RAM, or in the Registers 
#### Registers 
- Storage for the CPU
- Very little, but gives quick access for the CPU so stores important stuff
- Multiple types of Registers 
#### Main Memory (RAM)
- ~~Stores the program ~~ 
	- **Stores the CODE and DATA needed for the program to run**
- When a program is executed, it goes into the RAM
- **The CPU accesses the program ONE INSTRUCTION at a time**
#### Input/Output Devices 
- All devices the user is using 
	- keyboards, mice, printer, etc
	- **Hard Disks**
	- **USBs**
### Registers Overview
Registers is the CPUs storage, however, it is very little storage, so it must be used efficiently. There are 4 types of registers:
- Instruction ~~Registers~~ **Pointer**
- General **purpose** Registers 
- **Status** Flag Registers 
- Segment Registers 
#### Instruction Pointer
- Contains the address of the next instruction **to be executed by the CPU**
- Started as 16-bit, now as 32-bit called EIP (Extended) and 64-bit called RIP (Register)
- **ALSO CALLED THE PROGRAM COUNTER**
#### General Purpose Registers 
- Used for general ~~purposes during the execution of problems~~ **executions of instructions by the CPU**
- All are 32-bit **registers in x86 systems**, but extended ~~to~~ **as** 64-bit **registers** in 64-bit systems 
- There are multiple types of these registers 
##### EAX or RAX
- **AX stands for Accumulator Register**
- Stores the **result of** arithmetic operations of the CPU
- The **LAST** 16 bits can be accessed in the AX, or just the lower 8 bits with AL or higher 8 bits with ~~HA~~ **AH** 
- 32 bits are called EAX, and in 64-bits systems are called RAX
![[Pasted image 20241124123834.png]]
##### EBX or RBX
- Known as the Base Register, it stores the base address ~~of the offset~~ **for referencing an offset**
- 64-bit is RBX, 32-bit is EBX, 16-bit is BX, lower 8 is BL and upper is BH
![[Pasted image 20241124124057.png]]
##### ECX or ECX
- ~~Counting~~ **Counter** Register for loops and other iterations 
 - 64-bit is RCX, 32-bit is ECX, 16-bit is CX, lower 8 is CL and upper is CH
![[Pasted image 20241124124757.png]]
##### EDX or RDX
- Data Register
- Handles multiplication and division
 - 64-bit is RDX, 32-bit is EDX, 16-bit is DX, lower 8 is DL and upper is DH
![[Pasted image 20241124124917.png]]
##### EST or RST
- Stack Pointer 
- Points to the top of the stack 
- works in conjunction with the stack segment ~~pointer~~ **Register**
- **Only 32-bit (EST) and 64-bit (RST), CANNOT be addressed as smaller registers**
![[Pasted image 20241124125114.png]] 
##### EBP or RBP
- Base pointer 
- **Used to access parameters given by the stack**
- Used in 8 with the Stack Segment Register
- Only 32-bit and 64-bit
![[Pasted image 20241124125310.png]]
##### ESI or RSI
- Source Index Register 
- Used ~~with~~ **for** String operations 
- Used with the DS, Data Segment **as an offset**
- Only 32-bit and 64-bit
![[Pasted image 20241124125709.png]]
##### EDI or RDI
- Destination Index 
- Used with ~~Separate Register~~ **Extra Segment(ES)** as an offset
- only 32-bit and 64-bit
![[Pasted image 20241124125835.png]]
##### R8-R15
- Newer registers only in 64-bit systems 
- Can be addressed in 64-bit, 32-bit as **R8D**, 16-bit as **R8W**, 8-bit as **R8B**
### Registers - Continued

